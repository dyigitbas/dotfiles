version: 0.1.0
tasks:
  - name: winget
    description: Install Microsoft PowerToys
    parameters:
      package: Microsoft.PowerToys

  - name: powershell
    description: Import PowerToys settings
    script: |
      # Wait for PowerToys to be installed
      Start-Sleep -Seconds 5
      
      # Stop PowerToys if it's running
      $processList = Get-Process -Name "PowerToys" -ErrorAction SilentlyContinue
      if ($processList) {
          Stop-Process -Name "PowerToys" -Force
      }
      
      # Import PowerToys settings
      Copy-Item -Path "settings_133941469452703792.ptb" -Destination "$env:LOCALAPPDATA\Microsoft\PowerToys\Backup\settings_133941469452703792.ptb" -Force
      
      # Start PowerToys
      Start-Process "$env:LOCALAPPDATA\Microsoft\PowerToys\PowerToys.exe"

  - name: powershell
    description: Customize taskbar settings
    script: |
      # Disable Search icon/box on taskbar
      Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Search" -Name "SearchboxTaskbarMode" -Value 0

      # Disable Task View button
      Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" -Name "ShowTaskViewButton" -Value 0

      # Disable Widgets
      Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" -Name "TaskbarDa" -Value 0

      # Disable Chat/Teams icon (Windows 11)
      Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" -Name "TaskbarMn" -Value 0

      # Unpin all apps from taskbar
      Remove-Item -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Taskband" -Force -ErrorAction SilentlyContinue

      # Pin specific apps to taskbar
      $shell = New-Object -ComObject "Shell.Application"
      $folder = $shell.Namespace("C:\Program Files (x86)\Microsoft\Edge\Application")
      $item = $folder.ParseName("msedge.exe")
      if ($item) { $item.InvokeVerb("TaskbarPin") }

      $folder = $shell.Namespace("C:\Program Files\Microsoft Office\root\Office16")
      $item = $folder.ParseName("OUTLOOK.EXE")
      if ($item) { $item.InvokeVerb("TaskbarPin") }

      $folder = $shell.Namespace("C:\Program Files\Microsoft\Teams\current")
      $item = $folder.ParseName("Teams.exe")
      if ($item) { $item.InvokeVerb("TaskbarPin") }

      # Restart Explorer to apply changes
      Stop-Process -Name "explorer" -Force
      Start-Process "explorer"